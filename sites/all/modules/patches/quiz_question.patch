@@ -453 @@
function quiz_question_query_alter(QueryAlterableInterface $query) {
// This condition was running on every query the site sent, unless we were on the question index page. Want to drop out of all queries that should not have this 
+  if(!isset($query->alterMetaData)){
+    return;
+  }

+  if(isset($query->alterMetaData['node']) && $query->alterMetaData['node']){
+    if($query->alterMetaData['node']->type != 'question'){
+      return;
+    }
+    if($query->alterMetaData['node']->type != 'multichoice'){
+      return;
+    }
+  }

  if (!variable_get('quiz_index_questions')) {
    if ($types = array_keys(quiz_question_get_info())) {
      $tables = $query->getTables();
      foreach ($tables as $table) {
        if ($table['table'] == 'search_index') {
          // Remove the node IDs from the query.
          $query->condition('n.type, types, 'NOT IN');
        }
      }
    }
  }
}
